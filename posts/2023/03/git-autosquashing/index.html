<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Konrad Malik "><meta name=description content="Autosquashing A quick tip this time.
Sometimes you stumble on that one blog post that dramatically improves your life. Autosquashing Git Commits post from thoughtbot was such an improvement for me recently.
The problem You&amp;rsquo;re working on a merge request, pushing commit after commit. You&amp;rsquo;re in &amp;ldquo;the flow&amp;rdquo;.
Suddenly you realize - in the commit you&amp;rsquo;ve just pushed, there is a bug/typo/simple mistake, whatever. You want to change it, but the commit is already there."><meta name=keywords content=",tips,git"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://konradmalik.com/posts/2023/03/git-autosquashing/><title>Git Autosquashing :: Hi! I'm Konrad</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://konradmalik.com/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css><link rel=apple-touch-icon sizes=180x180 href=https://konradmalik.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://konradmalik.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://konradmalik.com/favicon-16x16.png><link rel=manifest href=https://konradmalik.com/site.webmanifest><link rel=mask-icon href=https://konradmalik.com/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://konradmalik.com/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Git Autosquashing"><meta itemprop=description content="Autosquashing A quick tip this time.
Sometimes you stumble on that one blog post that dramatically improves your life. Autosquashing Git Commits post from thoughtbot was such an improvement for me recently.
The problem You&rsquo;re working on a merge request, pushing commit after commit. You&rsquo;re in &ldquo;the flow&rdquo;.
Suddenly you realize - in the commit you&rsquo;ve just pushed, there is a bug/typo/simple mistake, whatever. You want to change it, but the commit is already there."><meta itemprop=datePublished content="2023-03-28T22:29:22+02:00"><meta itemprop=dateModified content="2023-03-28T22:29:22+02:00"><meta itemprop=wordCount content="741"><meta itemprop=keywords content="tips,git,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Git Autosquashing"><meta name=twitter:description content="Autosquashing A quick tip this time.
Sometimes you stumble on that one blog post that dramatically improves your life. Autosquashing Git Commits post from thoughtbot was such an improvement for me recently.
The problem You&rsquo;re working on a merge request, pushing commit after commit. You&rsquo;re in &ldquo;the flow&rdquo;.
Suddenly you realize - in the commit you&rsquo;ve just pushed, there is a bug/typo/simple mistake, whatever. You want to change it, but the commit is already there."><meta property="og:title" content="Git Autosquashing"><meta property="og:description" content="Autosquashing A quick tip this time.
Sometimes you stumble on that one blog post that dramatically improves your life. Autosquashing Git Commits post from thoughtbot was such an improvement for me recently.
The problem You&rsquo;re working on a merge request, pushing commit after commit. You&rsquo;re in &ldquo;the flow&rdquo;.
Suddenly you realize - in the commit you&rsquo;ve just pushed, there is a bug/typo/simple mistake, whatever. You want to change it, but the commit is already there."><meta property="og:type" content="article"><meta property="og:url" content="https://konradmalik.com/posts/2023/03/git-autosquashing/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-28T22:29:22+02:00"><meta property="article:modified_time" content="2023-03-28T22:29:22+02:00"><meta property="article:published_time" content="2023-03-28 22:29:22 +0200 +0200"></head><body><div class=container><header class=header><span class=header__inner><a href=https://konradmalik.com/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ cd /home/konrad</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://konradmalik.com/posts/>Posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 minutes</p></div><article><h1 class=post-title><a href=https://konradmalik.com/posts/2023/03/git-autosquashing/>Git Autosquashing</a></h1><div class=post-content><h2 id=autosquashing>Autosquashing</h2><p>A quick tip this time.</p><p>Sometimes you stumble on that one blog post that dramatically improves your life.
<a href=https://thoughtbot.com/blog/autosquashing-git-commits>Autosquashing Git Commits</a> post from thoughtbot was
such an improvement for me recently.</p><h3 id=the-problem>The problem</h3><p>You&rsquo;re working on a merge request, pushing commit after commit. You&rsquo;re in &ldquo;the flow&rdquo;.</p><p>Suddenly you realize - in the commit you&rsquo;ve just pushed, there is a bug/typo/simple mistake, whatever.
You want to change it, but the commit is already there. Easy peasy, just <code>git commit --amend</code> it. Done.</p><p>But&mldr; what if you committed <code>A</code>, then committed <code>B</code>, but while working on <code>C</code> you&rsquo;ve found a bug that
<code>A</code> introduced? Or a change that really should&rsquo;ve been placed along with the commit <code>A</code>?</p><h3 id=the-solution>The solution</h3><p>Usually, at this stage, I committed the change, then I did <code>git rebase --interactive HEAD~4</code> or something like that,
then I moved commits around and used either <code>fixup</code> or <code>squash</code>. It does work, but it&rsquo;s not ideal. It involves many steps, you need to manually
rearrange the commits every single time. It&rsquo;s distracting.
Of course, I could just move ahead and rebase at the very end, but I&rsquo;m sure that I&rsquo;d forget that, especially if there were more commits like that.</p><p>Is there a better way? Sure, that&rsquo;s the whole point of this post! Actually, there are two better ways:</p><ul><li><code>git commit --fixup &lt;rev></code></li><li><code>git commit --squash &lt;rev></code></li></ul><p>What&rsquo;s that? Easy. The <code>fixup</code> one, commits your changes, but automatically creates a commit message so that it will contain <code>fixup! &lt;message of rev></code>. Squash works analogously, but creates <code>squash! &lt;message of rev></code>.</p><p>Why is that so neat? Well, because now, when you run <code>git rebase --interactive --autosquash ...</code> (notice the last flag) then git
will automatically place your commits correctly (right after the <code>rev</code> you specified) and will add the proper rebase verb (<code>fixup</code> or <code>squash</code>).</p><p>Great! I had one instant question: how can I tell git to always use <code>--autosquash</code>? Well: <code>git config --global rebase.autosquash true</code>. Done.</p><p>One last thing. Finding the <code>&lt;rev></code> to <code>fixup</code> or <code>squash</code> is a little inconvenient. Usually, I open <code>git log</code>, copy the sha, etc&mldr; Is there an easier way? Sure! This is another thing I&rsquo;ve learned from that article: you can refer to commits by their commit message! So to <code>fixup</code> a commit with the message &ldquo;fix: null reference bug&rdquo; you can just use <code>git commit --fixup :/null</code>. Note that
this will always refer to the <em>latest</em> commit with the matching message, keep that in mind.</p><h3 id=quick-example>Quick example</h3><p>Current state:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>commit 000e92965066ad7494b392ec51e3f573777ef1b4 <span style=color:#f92672>(</span>HEAD -&gt; main, origin/main<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 22:25:57 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    refactor<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: starship tuning
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>commit d52f126d62c020bfdb7782594d5d69e146c80ab3
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 22:15:23 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    feat<span style=color:#f92672>(</span>tmux<span style=color:#f92672>)</span>: cleaner theme
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>commit c7311af61600e7f13c31f472840d9fbd08d391c0
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 18:22:35 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    feat<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: add flash-to and enable shlvl
</span></span></code></pre></div><p>Let&rsquo;s assume I&rsquo;ve changed some files related to shlvl configuration (<a href=https://starship.rs/config/#shlvl>starship</a>) and
want to add them to <code>c7311af6</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git commit --fixup :/shlvl
</span></span></code></pre></div><p>New state:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>commit 5c62951708d2f75cbedc7810f467c001105e541e <span style=color:#f92672>(</span>HEAD -&gt; main<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 23:03:18 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fixup! feat<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: add flash-to and enable shlvl
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>commit 000e92965066ad7494b392ec51e3f573777ef1b4 <span style=color:#f92672>(</span>origin/main<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 22:25:57 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    refactor<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: starship tuning
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>commit d52f126d62c020bfdb7782594d5d69e146c80ab3
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 22:15:23 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    feat<span style=color:#f92672>(</span>tmux<span style=color:#f92672>)</span>: cleaner theme
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>commit c7311af61600e7f13c31f472840d9fbd08d391c0
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 18:22:35 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    feat<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: add flash-to and enable shlvl
</span></span></code></pre></div><p>Now:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># no need for --autosquash if you&#39;ve set the global option like me</span>
</span></span><span style=display:flex><span>$ git rebase --autosquash --interactive @~5
</span></span></code></pre></div><p>What git rebase windows shows (notice all commits are already correctly reordered and with proper verbs):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pick f041654 feat: rpi4 images as packages
</span></span><span style=display:flex><span>pick c7311af feat<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: add flash-to and enable shlvl
</span></span><span style=display:flex><span>fixup 5c62951 fixup! feat<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: add flash-to and enable shlvl
</span></span><span style=display:flex><span><span style=color:#75715e># here ^</span>
</span></span><span style=display:flex><span>pick d52f126 feat<span style=color:#f92672>(</span>tmux<span style=color:#f92672>)</span>: cleaner theme
</span></span><span style=display:flex><span>pick 000e929 refactor<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: starship tuning
</span></span></code></pre></div><p>And finally, after rebase:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>commit c0fc2e83937b55d2ed95ab986ff636acb4da1939 <span style=color:#f92672>(</span>HEAD -&gt; main<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 22:25:57 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    refactor<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: starship tuning
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>commit 21c8c26f44fc117c457df37b2973cbbb2a150122
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 22:15:23 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    feat<span style=color:#f92672>(</span>tmux<span style=color:#f92672>)</span>: cleaner theme
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>commit 74666cc140411c11f3b20f7c911cf10cf64f11db
</span></span><span style=display:flex><span>Author: Konrad Malik &lt;konrad.malik@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Tue Mar <span style=color:#ae81ff>28</span> 18:22:35 <span style=color:#ae81ff>2023</span> +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    feat<span style=color:#f92672>(</span>shell<span style=color:#f92672>)</span>: add flash-to and enable shlvl
</span></span></code></pre></div><p>Done!</p><h3 id=conclusion>Conclusion</h3><p>First, read the <a href=https://thoughtbot.com/blog/autosquashing-git-commits>original article</a>.</p><p>Second, enable <code>rebase.autosquash</code> in your git config.</p><p>Third, if referring to revs by a part of a message blew your mind just like mine, type <code>man gitrevisions</code>, read it, and thank me later.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://konradmalik.com/tags/tips/>tips</a></span>
<span class=tag><a href=https://konradmalik.com/tags/git/>git</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>741 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2023-03-28 20:29</p></div><div class=pagination><div class=pagination__buttons><span class="button next"><a href=https://konradmalik.com/posts/2023/02/sops-nix-simple-secrets-management-for-nix/><span class=button__text>sops-nix: simple secrets management for Nix</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2023</span>
<span><a href=https://konradmalik.com>Konrad Malik</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span>
<span><a href=https://konradmalik.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span></div></div></footer></div><script type=text/javascript src=https://konradmalik.com/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script></body></html>